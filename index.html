<!DOCTYPE html>
<html lang="en">
<head>
  <base href="/oct-testbed/">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Open-Source Consciousness Testbed (OCT)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg-primary: #0D1117;
      --bg-secondary: #161B22;
      --border-color: #30363D;
      --text-primary: #C9D1D9;
      --text-secondary: #8B949E;
      --accent-blue: #58A6FF;
      --accent-green: #3FB950;
      --accent-red: #F85149;
      --accent-purple: #BC8CFF;
    }
    body {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background-color: var(--bg-primary);
      color: var(--text-primary);
      overscroll-behavior: none;
    }
    .canvas-container {
      background-color: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 0.75rem;
      overflow: hidden;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }
    .panel-title {
      text-align: center;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
    }
    .btn {
      transition: all 0.2s ease-in-out;
      border: 1px solid transparent;
      border-radius: 0.5rem;
      padding: 0.5rem 1rem;
      font-weight: 600;
      color: white;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: translateY(0);
      box-shadow: none;
    }
    .gemini-output {
      background-color: rgba(0,0,0,0.2);
      border-radius: 0.5rem;
      padding: 1rem;
      height: 100%;
      overflow-y: auto;
      color: var(--text-secondary);
      font-style: italic;
      border: 1px solid var(--border-color);
    }
    .status-indicator {
      width: 1rem;
      height: 1rem;
      border-radius: 50%;
      margin-right: 0.5rem;
      flex-shrink: 0;
    }
    .status-nominal { background-color: var(--accent-green); }
    .status-watch { background-color: #D29922; }
    .status-alert { background-color: var(--accent-red); }
    .metric-label { color: var(--text-secondary); }
    .metric-value { font-weight: 600; color: var(--text-primary); }

    canvas { display: block; width: 100%; height: 100%; }
  </style>
</head>
<body class="antialiased">
  <div class="min-h-screen flex flex-col p-4 md:p-6 lg:p-8">

    <header class="text-center mb-6">
      <h1 class="text-3xl md:text-4xl font-bold text-white">Open-Source Consciousness Testbed (OCT)</h1>
      <p class="text-lg md:text-xl text-gray-400">A Unified Framework for Comparative Consciousness Research</p>
    </header>

    <main class="flex-grow grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6">
      <!-- AI Substrate Column -->
      <div class="flex flex-col gap-4 lg:gap-6">
        <div class="text-center bg-blue-900/50 border border-blue-500/50 rounded-lg py-2">
          <h2 class="text-xl font-bold" style="color: var(--accent-blue)">AI Substrate (LLM Simulation)</h2>
        </div>

        <div class="canvas-container flex-grow">
          <h3 class="panel-title">AI: Dynamic Functional Connectivity (dFNC)</h3>
          <div class="flex-grow relative">
            <canvas id="ai-dFNC-canvas"></canvas>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
          <div class="canvas-container" style="aspect-ratio:1/1;">
            <h3 class="panel-title">AI: Non-Local Correlation Matrix</h3>
            <canvas id="ai-NLCA-canvas"></canvas>
          </div>
          <div class="canvas-container" style="aspect-ratio:1/1;">
            <h3 class="panel-title">AI: Perturbational Complexity (dPCI)</h3>
            <canvas id="ai-dPCI-canvas"></canvas>
          </div>
        </div>
      </div>

      <!-- Biological Analogue Column -->
      <div class="flex flex-col gap-4 lg:gap-6">
        <div class="text-center bg-green-900/50 border border-green-500/50 rounded-lg py-2">
          <h2 class="text-xl font-bold" style="color: var(--accent-green)">Biological Analogue (EEG/fMRI Proxy)</h2>
        </div>

        <div class="canvas-container flex-grow">
          <h3 class="panel-title">Bio: Dynamic Functional Connectivity (dFNC)</h3>
          <div class="flex-grow relative">
            <canvas id="bio-dFNC-canvas"></canvas>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
          <div class="canvas-container" style="aspect-ratio:1/1;">
            <h3 class="panel-title">Bio: EEG Microstates</h3>
            <canvas id="bio-microstates-canvas"></canvas>
          </div>
          <div class="canvas-container" style="aspect-ratio:1/1;">
            <h3 class="panel-title">Bio: Perturbational Complexity (PCI)</h3>
            <canvas id="bio-dPCI-canvas"></canvas>
          </div>
        </div>
      </div>

      <!-- Causal Web-Work -->
      <div class="lg:col-span-2 canvas-container min-h-64">
        <h2 class="panel-title text-xl" style="color: var(--accent-purple)">Causal Web-Work (Dynamic Bayesian Network) &amp; Φ Estimate</h2>
        <div class="flex-grow">
          <canvas id="phi-canvas"></canvas>
        </div>
      </div>

      <!-- Control & Interpretation -->
      <div class="lg:col-span-2 grid grid-cols-1 xl:grid-cols-2 gap-4 lg:gap-6">
        <div class="canvas-container">
          <h2 class="panel-title">System Controls</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <button id="btn-adversarial" class="btn bg-red-600 hover:bg-red-500">Adversarial</button>
            <button id="btn-poison" class="btn bg-purple-600 hover:bg-purple-500">Poison</button>
            <button id="btn-prompt" class="btn bg-blue-600 hover:bg-blue-500">Bombard</button>
            <button id="btn-reset" class="btn bg-gray-600 hover:bg-gray-500">Reset</button>
          </div>

          <div class="mt-4 border-t border-border-color pt-4">
            <h3 class="panel-title text-base mb-3">AI Simulation Parameters</h3>
            <div class="space-y-3 text-sm">
              <div class="flex items-center justify-between gap-3">
                <label for="ai-roi-slider" class="metric-label flex-shrink-0">ROI Count</label>
                <input type="range" id="ai-roi-slider" min="10" max="100" value="35" class="w-full">
                <span id="ai-roi-value" class="metric-value w-8 text-center">35</span>
              </div>
              <div class="flex items-center justify-between gap-3">
                <label for="ai-matrix-slider" class="metric-label flex-shrink-0">Matrix Size</label>
                <input type="range" id="ai-matrix-slider" min="8" max="48" value="24" class="w-full">
                <span id="ai-matrix-value" class="metric-value w-8 text-center">24</span>
              </div>
              <div class="flex items-center justify-between gap-3">
                <label for="ai-volatility-slider" class="metric-label flex-shrink-0">Volatility</label>
                <input type="range" id="ai-volatility-slider" min="0" max="100" value="20" class="w-full">
                <span id="ai-volatility-value" class="metric-value w-12 text-center">0.02</span>
              </div>
            </div>
          </div>

          <div class="mt-4 border-t border-border-color pt-4 text-sm">
            <h3 class="panel-title text-base mb-3">Interpretation Settings</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between gap-3">
                <label for="provider-select" class="metric-label">Provider</label>
                <select id="provider-select" class="w-full rounded text-white" style="background-color: var(--bg-secondary); border-color: var(--border-color);"></select>
              </div>
              <div class="flex items-center justify-between gap-3">
                <label for="api-key-input" class="metric-label">API Key</label>
                <input type="password" id="api-key-input" class="w-full rounded text-white" style="background-color: var(--bg-secondary); border-color: var(--border-color);" placeholder="Enter API key...">
                <button id="save-key-btn" class="btn bg-emerald-700 hover:bg-emerald-600 text-xs px-3 py-1">Save</button>
              </div>
              <div class="flex items-center justify-center gap-3 pt-2 border-t border-border-color">
                <label for="gemini-toggle" class="metric-label">Use Online Interpretation</label>
                <input type="checkbox" id="gemini-toggle" class="h-5 w-5 rounded" style="background-color: var(--bg-primary); border-color: var(--border-color);">
                <span id="gemini-status-message" class="text-xs text-amber-400 hidden"></span>
              </div>
            </div>
          </div>

          <div class="mt-4 pt-4 border-t border-border-color">
            <button id="btn-interpret" class="w-full btn bg-emerald-600 hover:bg-emerald-500 text-lg">✨ Generate Comparative Interpretation</button>
          </div>
        </div>

        <div class="canvas-container">
          <h2 class="panel-title">Ethical &amp; Safety Dashboard</h2>
          <div class="space-y-3">
            <div class="flex items-center">
              <div id="sq-indicator" class="status-indicator status-nominal"></div>
              <span class="metric-label">Sentience Quotient (SQ):</span>
              <span id="sq-value" class="metric-value ml-auto">0.00</span>
            </div>
            <div class="flex items-center">
              <div id="al-indicator" class="status-indicator status-nominal"></div>
              <span class="metric-label">Autonomy Level (AL):</span>
              <span id="al-value" class="metric-value ml-auto">0.00</span>
            </div>
            <div class="flex items-center">
              <div id="co-indicator" class="status-indicator status-nominal"></div>
              <span class="metric-label">Causal Opacity (CO):</span>
              <span id="co-value" class="metric-value ml-auto">0.00</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Gemini Output -->
      <div class="lg:col-span-2">
        <div class="canvas-container min-h-40">
          <h2 class="panel-title">AI Internal Monologue &amp; State Analysis (via Gemini)</h2>
          <div id="gemini-output" class="gemini-output flex-grow">
            Click "Generate Comparative Interpretation" to produce a narrative analysis of the current system states...
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="js/providers.js"></script>
  <script src="app.js"></script>
<script>window.parent.postMessage({ action: "ready" }, "*"); 
 
window.console = new Proxy(console, {
  get(target, prop) {
    if (['log', 'warn', 'error'].includes(prop)) {
      return new Proxy(target[prop], {
        apply(fn, thisArg, args) {
          fn.apply(thisArg, args);
          window.parent.postMessage({ action: 'console', 
            type: prop, 
            args: args.map((arg) => {
              try {
                return JSON.stringify(arg).replace(/^["']|["']$/g, '');
              } catch (e) {
                return arg;
              }
            }) 
          }, '*');
        }
      });
    }
    return target[prop];
  }
});
</script></body>
</html>
